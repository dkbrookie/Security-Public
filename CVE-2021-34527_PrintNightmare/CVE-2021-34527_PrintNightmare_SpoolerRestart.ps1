<#
    Disables ACL, restarts spooler, enables ACL. This allows a print server to export its printer shares properly but still have its driver folder locked down.
    Run this if a server with a locked down spool/drivers folder is failing to export its shared printers
#>

$Path = "C:\Windows\System32\spool\drivers"

# Remove ACL
$Acl1 = (Get-Item $Path).GetAccessControl('Access')

$Ar1 = New-Object System.Security.AccessControl.FileSystemAccessRule("System", "Modify", "ContainerInherit, ObjectInherit", "None", "Deny")

$Acl1.RemoveAccessRule($Ar1)

Set-Acl $Path $Acl1

# Restart print spooler
Restart-Service Spooler

# Re-Enable ACL
$Acl2 = (Get-Item $Path).GetAccessControl('Access')

$Ar2 = New-Object  System.Security.AccessControl.FileSystemAccessRule("System", "Modify", "ContainerInherit, ObjectInherit", "None", "Deny")

$Acl2.AddAccessRule($Ar2)

Set-Acl $Path $Acl2
